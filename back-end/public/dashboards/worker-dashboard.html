<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Worker</title></head><body>
<h2>Worker - Assigned</h2>
<table id="t"><thead><tr><th>ID</th><th>Category</th><th>Description</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table>
<script>
async function load(){
  const wid = localStorage.getItem('uid') || 'worker-test';
  const res = await fetch('http://127.0.0.1:8000/complaints?worker_id='+wid);
  const data = await res.json();
  const tbody = document.querySelector('#t tbody'); tbody.innerHTML='';
  for(const c of data.complaints){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${c.id}</td><td>${c.category}</td><td>${c.description}</td><td>${c.status}</td>
      <td>${c.status!=='resolved'?`<button onclick="resolve('${c.id}')">Mark Resolved</button>`:'-'}</td>`;
    tbody.appendChild(tr);
  }
}
async function resolve(id){
  const res = await fetch(`http://127.0.0.1:8000/complaints/${id}/status?status=resolved`, { method: 'PUT', headers: { 'Authorization': 'Bearer '+localStorage.getItem('idToken') || '' }});
  if(res.ok){ alert('Marked resolved'); load(); } else alert('Failed');
}
window.addEventListener('DOMContentLoaded', load);
</script>
</body></html>
